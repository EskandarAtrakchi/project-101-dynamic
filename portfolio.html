<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Crypto Portfolio</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: "Golos Text",sans-serif!important;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #06111d;
            color: #fff;
        }

        .app {
            margin: 20px 160px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 14px 8px;
            border-bottom: 1px solid #ddd;
        }

        th {
            color: #9da0a6;
        }

        .asset-logo {
            width: 40px;
            height: 40px;
        }

        .positive {
            color: #4fbf67;
        }

        .negative {
            color: #ff5c5c;
        }

        /* Include the rest of your CSS here */
    </style>
</head>
<body>
    <div id="app">
        <h1>My Crypto Portfolio</h1>
        <div>
            <input id="address-input" type="text" placeholder="Enter Wallet Address" />
            <button id="fetch-button">Fetch Assets</button>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Logo</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Value</th>
                    <th>24h Change</th>
                </tr>
            </thead>
            <tbody id="assets-table">
                <!-- Assets will be populated here -->
            </tbody>
        </table>
    </div>

    <script>
        var address = '0x209c8bbE2454257Eb1A8E630f59f4b1b50a98543';
        var assets = [];

        function fetchAssets(address) {
            fetch(`https://project-101-dynamic.onrender.com/portfolio.html/${address}`)
                .then(response => response.text())  // Get response text
                .then(text => {
                    try {
                        // Try to parse the text as JSON
                        const data = JSON.parse(text);
                        console.log(data.result);
                        assets = data.result;
                        updateTable();
                    } catch (error) {
                        // If parsing as JSON fails, log the raw text
                        console.error("Raw response:", text);
                        console.error("Error parsing JSON:", error);
                    }
                })
                .catch(error => console.error("Error fetching assets:", error));
        }

        function updateTable() {
            var table = document.getElementById('assets-table');
            table.innerHTML = '';
            assets.forEach(asset => {
                var row = `<tr>
                    <td><img src="${asset.thumbnail}" alt="${asset.name}" class="asset-logo" /></td>
                    <td>${asset.name}</td>
                    <td>$${parseFloat(asset.usd_price?.toFixed(2))}</td>
                    <td>$${parseFloat(asset.usd_value?.toFixed(2))}</td>
                    <td class="${asset.usd_price_24hr_percent_change < 0 ? 'negative' : 'positive'}">
                        ${parseFloat(asset.usd_price_24hr_percent_change?.toFixed(2))}%
                    </td>
                </tr>`;
                table.innerHTML += row;
            });
        }

        document.getElementById('address-input').addEventListener('change', function(e) {
            address = e.target.value;
        });

        document.getElementById('fetch-button').addEventListener('click', function() {
            fetchAssets(address);
        });

        fetchAssets(address);
    </script>
</body>
</html>